generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      Int             @id @default(autoincrement())
  telegramId              String          @unique @db.VarChar(255)
  username                String?         @db.VarChar(255)
  firstName               String?         @db.VarChar(255)
  lastName                String?         @db.VarChar(255)
  photoUrl                String?
  languageCode            String?         @db.VarChar(10)
  isPremium               Boolean         @default(false)
  level                   Int             @default(1)
  points                  Int             @default(0)
  pointsHistory           PointsHistory[]
  referralCode            String          @unique
  referredBy              String?
  referralCount           Int             @default(0)
  lastDailyClaimAt        DateTime?
  dailyStreak             Int             @default(0)
  walletAddress           String?
  walletConnectedAt       DateTime?
  paymentWalletAddress    String?
  paymentWalletVerified   Boolean         @default(false)
  paymentWalletVerifiedAt DateTime?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt

  @@index([id, createdAt(sort: Desc)])
  @@map("users")
}

model PointsHistory {
  id          Int              @id @default(autoincrement())
  amount      Int
  type        PointHistoryType @default(DAILY)
  description String?          @db.VarChar(255)
  created_at  DateTime         @default(now())
  user        User             @relation(fields: [userId], references: [id])
  userId      Int

  @@index([userId, created_at(sort: Desc)])
  @@map("points_history")
}

enum PointHistoryType {
  DAILY
  PURCHASE
}

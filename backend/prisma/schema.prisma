generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int             @id @default(autoincrement())
  email         String          @unique @db.VarChar(300)
  username      String?
  level         Int             @default(1)
  points        Int             @default(0)
  pointsHistory PointsHistory[]
  dailyStreaks  DailyStreaks?
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt

  @@index([id, created_at(sort: Desc)])
  @@map("users")
}

model DailyStreaks {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      Int      @unique
  streakCount Int      @default(0)
  lastUpdate  DateTime @default(now())

  @@map("daily_streaks")
}

model PointsHistory {
  id          Int              @id @default(autoincrement())
  amount      Int
  type        PointHistoryType @default(DAILY)
  description String?          @db.VarChar(255)
  created_at  DateTime         @default(now())
  user        User             @relation(fields: [userId], references: [id])
  userId      Int

  @@index([userId, created_at(sort: Desc)])
  @@map("points_history")
}

enum PointHistoryType {
  DAILY
  PURCHASE
}
